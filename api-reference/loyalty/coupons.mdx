---
title: "Generate Coupon"
api: "POST /loyalty/coupons/generate"
description: "Generate personalized discount coupons for customers based on their loyalty status and behavior"
---

## Overview

This endpoint generates personalized discount coupons for customers as rewards or marketing incentives. Coupons can be percentage-based, fixed amount, or free shipping, with configurable expiration and usage limits.

## Authentication

<ParamField header="Authorization" type="string" required>
  Bearer token for API authentication
  ```
  Authorization: Bearer {your_api_key}
  ```
</ParamField>

## Request Body

<ParamField body="customer" type="object" required>
  Customer identification for coupon generation
  
  <Expandable title="Customer Object">
    <ParamField body="member_code" type="string">
      Zupy customer member code (highest priority)
      ```
      ZP-12345678
      ```
    </ParamField>
    
    <ParamField body="whatsapp" type="string">
      Customer's WhatsApp number
      ```
      +5511965958122
      ```
    </ParamField>
    
    <ParamField body="email" type="string">
      Customer's email address
      ```
      joao@email.com
      ```
    </ParamField>
    
    <ParamField body="cpf" type="string">
      Customer's CPF number
      ```
      12345678901
      ```
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="coupon_type" type="string" required>
  Type of discount coupon to generate
  ```
  percentage | fixed_amount | free_shipping | bogo | points_multiplier
  ```
</ParamField>

<ParamField body="discount_value" type="number" required>
  Discount value (percentage or fixed amount in BRL)
  ```
  15.0  // 15% or R$15.00 depending on coupon_type
  ```
</ParamField>

<ParamField body="minimum_purchase" type="number">
  Minimum purchase amount required to use coupon (in BRL)
  ```
  50.00
  ```
</ParamField>

<ParamField body="maximum_discount" type="number">
  Maximum discount amount for percentage coupons (in BRL)
  ```
  100.00
  ```
</ParamField>

<ParamField body="valid_days" type="number">
  Number of days the coupon remains valid (default: 30)
  ```
  30
  ```
</ParamField>

<ParamField body="usage_limit" type="number">
  Maximum number of times coupon can be used (default: 1)
  ```
  1
  ```
</ParamField>

<ParamField body="applicable_categories" type="array">
  Product categories where coupon can be applied
  ```
  ["electronics", "fashion", "food"]
  ```
</ParamField>

<ParamField body="excluded_products" type="array">
  Specific products excluded from coupon discount
  ```
  ["prod_123", "prod_456"]
  ```
</ParamField>

<ParamField body="campaign_id" type="string">
  Marketing campaign identifier for tracking
  ```
  camp_birthday2024
  ```
</ParamField>

<ParamField body="personalization" type="object">
  Personalization options for the coupon
  
  <Expandable title="Personalization Object">
    <ParamField body="title" type="string">
      Custom coupon title
      ```
      Desconto Especial de Aniversário
      ```
    </ParamField>
    
    <ParamField body="description" type="string">
      Custom coupon description
      ```
      Aproveite 15% de desconto em toda a loja!
      ```
    </ParamField>
    
    <ParamField body="color_scheme" type="string">
      Visual color scheme
      ```
      gold | silver | bronze | purple | blue
      ```
    </ParamField>
    
    <ParamField body="custom_message" type="string">
      Personal message for the customer
      ```
      Parabéns pelos seus 2 anos como cliente Zupy!
      ```
    </ParamField>
  </Expandable>
</ParamField>

## Response

<ResponseField name="success" type="boolean">
  Indicates if the coupon was generated successfully
</ResponseField>

<ResponseField name="data" type="object">
  Generated coupon information
  
  <Expandable title="Coupon Object">
    <ResponseField name="coupon_id" type="string">
      Unique coupon identifier
    </ResponseField>
    
    <ResponseField name="coupon_code" type="string">
      Customer-facing coupon code
    </ResponseField>
    
    <ResponseField name="qr_code" type="string">
      Base64 encoded QR code image for easy scanning
    </ResponseField>
    
    <ResponseField name="type" type="string">
      Coupon discount type
    </ResponseField>
    
    <ResponseField name="discount_value" type="number">
      Discount value (percentage or amount)
    </ResponseField>
    
    <ResponseField name="minimum_purchase" type="number">
      Minimum purchase amount required
    </ResponseField>
    
    <ResponseField name="maximum_discount" type="number">
      Maximum discount amount (for percentage coupons)
    </ResponseField>
    
    <ResponseField name="customer" type="object">
      Customer information
      
      <Expandable title="Customer Object">
        <ResponseField name="member_code" type="string">
          Customer's Zupy member code
        </ResponseField>
        
        <ResponseField name="name" type="string">
          Customer's full name
        </ResponseField>
        
        <ResponseField name="customer_segment" type="string">
          Customer's loyalty segment
        </ResponseField>
      </Expandable>
    </ResponseField>
    
    <ResponseField name="validity" type="object">
      Coupon validity information
      
      <Expandable title="Validity Object">
        <ResponseField name="valid_from" type="string">
          Coupon start date (ISO 8601)
        </ResponseField>
        
        <ResponseField name="valid_until" type="string">
          Coupon expiration date (ISO 8601)
        </ResponseField>
        
        <ResponseField name="days_remaining" type="number">
          Days until expiration
        </ResponseField>
      </Expandable>
    </ResponseField>
    
    <ResponseField name="usage" type="object">
      Usage tracking information
      
      <Expandable title="Usage Object">
        <ResponseField name="usage_limit" type="number">
          Maximum number of uses allowed
        </ResponseField>
        
        <ResponseField name="times_used" type="number">
          Number of times already used
        </ResponseField>
        
        <ResponseField name="remaining_uses" type="number">
          Remaining uses available
        </ResponseField>
      </Expandable>
    </ResponseField>
    
    <ResponseField name="restrictions" type="object">
      Coupon restrictions and conditions
      
      <Expandable title="Restrictions Object">
        <ResponseField name="applicable_categories" type="array">
          Categories where coupon applies
        </ResponseField>
        
        <ResponseField name="excluded_products" type="array">
          Products excluded from discount
        </ResponseField>
        
        <ResponseField name="store_locations" type="array">
          Store locations where coupon is valid
        </ResponseField>
        
        <ResponseField name="online_only" type="boolean">
          Whether coupon is valid only for online purchases
        </ResponseField>
      </Expandable>
    </ResponseField>
    
    <ResponseField name="personalization" type="object">
      Custom coupon presentation data
    </ResponseField>
    
    <ResponseField name="status" type="string">
      Current coupon status
      ```
      active | used | expired | cancelled
      ```
    </ResponseField>
    
    <ResponseField name="campaign_id" type="string">
      Associated marketing campaign
    </ResponseField>
    
    <ResponseField name="created_at" type="string">
      Coupon creation timestamp (ISO 8601)
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseField name="message" type="string">
  Human-readable response message
</ResponseField>

<ResponseField name="timestamp" type="string">
  Response timestamp in ISO 8601 format
</ResponseField>

## Example Request

<CodeGroup>
```bash cURL
curl -X POST "https://api.zupy.com/v1/loyalty/coupons/generate" \
  -H "Authorization: Bearer YOUR_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "customer": {
      "member_code": "ZP-12345678"
    },
    "coupon_type": "percentage",
    "discount_value": 15.0,
    "minimum_purchase": 50.00,
    "maximum_discount": 100.00,
    "valid_days": 30,
    "usage_limit": 1,
    "applicable_categories": ["electronics", "fashion"],
    "campaign_id": "birthday2024",
    "personalization": {
      "title": "Desconto Especial de Aniversário",
      "description": "Aproveite 15% de desconto em eletrônicos e moda!",
      "color_scheme": "gold",
      "custom_message": "Parabéns pelos seus 2 anos como cliente Zupy!"
    }
  }'
```

```javascript JavaScript
const response = await fetch('https://api.zupy.com/v1/loyalty/coupons/generate', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer YOUR_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    customer: {
      member_code: 'ZP-12345678'
    },
    coupon_type: 'percentage',
    discount_value: 15.0,
    minimum_purchase: 50.00,
    maximum_discount: 100.00,
    valid_days: 30,
    usage_limit: 1,
    applicable_categories: ['electronics', 'fashion'],
    campaign_id: 'birthday2024',
    personalization: {
      title: 'Desconto Especial de Aniversário',
      description: 'Aproveite 15% de desconto em eletrônicos e moda!',
      color_scheme: 'gold',
      custom_message: 'Parabéns pelos seus 2 anos como cliente Zupy!'
    }
  })
});

const data = await response.json();
console.log(data);
```

```python Python
import requests

url = "https://api.zupy.com/v1/loyalty/coupons/generate"
headers = {
    "Authorization": "Bearer YOUR_API_KEY",
    "Content-Type": "application/json"
}

payload = {
    "customer": {
        "member_code": "ZP-12345678"
    },
    "coupon_type": "percentage",
    "discount_value": 15.0,
    "minimum_purchase": 50.00,
    "maximum_discount": 100.00,
    "valid_days": 30,
    "usage_limit": 1,
    "applicable_categories": ["electronics", "fashion"],
    "campaign_id": "birthday2024",
    "personalization": {
        "title": "Desconto Especial de Aniversário",
        "description": "Aproveite 15% de desconto em eletrônicos e moda!",
        "color_scheme": "gold",
        "custom_message": "Parabéns pelos seus 2 anos como cliente Zupy!"
    }
}

response = requests.post(url, json=payload, headers=headers)
data = response.json()
print(data)
```

```php PHP
<?php
$url = "https://api.zupy.com/v1/loyalty/coupons/generate";

$headers = [
    "Authorization: Bearer YOUR_API_KEY",
    "Content-Type: application/json"
];

$payload = [
    "customer" => [
        "member_code" => "ZP-12345678"
    ],
    "coupon_type" => "percentage",
    "discount_value" => 15.0,
    "minimum_purchase" => 50.00,
    "maximum_discount" => 100.00,
    "valid_days" => 30,
    "usage_limit" => 1,
    "applicable_categories" => ["electronics", "fashion"],
    "campaign_id" => "birthday2024",
    "personalization" => [
        "title" => "Desconto Especial de Aniversário",
        "description" => "Aproveite 15% de desconto em eletrônicos e moda!",
        "color_scheme" => "gold",
        "custom_message" => "Parabéns pelos seus 2 anos como cliente Zupy!"
    ]
];

$response = file_get_contents($url, false, stream_context_create([
    'http' => [
        'method' => 'POST',
        'header' => implode("\r\n", $headers),
        'content' => json_encode($payload)
    ]
]));

$data = json_decode($response, true);
print_r($data);
?>
```
</CodeGroup>

## Example Response

<CodeGroup>
```json 201 - Coupon Generated Successfully
{
  "success": true,
  "data": {
    "coupon_id": "coup_abc123xyz789",
    "coupon_code": "BIRTHDAY15-ZP12345",
    "qr_code": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgA...",
    "type": "percentage",
    "discount_value": 15.0,
    "minimum_purchase": 50.00,
    "maximum_discount": 100.00,
    "customer": {
      "member_code": "ZP-12345678",
      "name": "João Silva",
      "customer_segment": "Loyal Customers"
    },
    "validity": {
      "valid_from": "2024-02-10T14:30:00Z",
      "valid_until": "2024-03-11T23:59:59Z",
      "days_remaining": 30
    },
    "usage": {
      "usage_limit": 1,
      "times_used": 0,
      "remaining_uses": 1
    },
    "restrictions": {
      "applicable_categories": ["electronics", "fashion"],
      "excluded_products": [],
      "store_locations": ["all"],
      "online_only": false
    },
    "personalization": {
      "title": "Desconto Especial de Aniversário",
      "description": "Aproveite 15% de desconto em eletrônicos e moda!",
      "color_scheme": "gold",
      "custom_message": "Parabéns pelos seus 2 anos como cliente Zupy!"
    },
    "status": "active",
    "campaign_id": "birthday2024",
    "created_at": "2024-02-10T14:30:00Z"
  },
  "message": "Coupon generated successfully",
  "timestamp": "2024-02-10T14:30:00Z"
}
```

```json 400 - Invalid Coupon Configuration
{
  "success": false,
  "error": {
    "code": "INVALID_COUPON_CONFIG",
    "message": "Invalid coupon configuration provided",
    "details": {
      "discount_value": ["Percentage discount must be between 1 and 50"],
      "minimum_purchase": ["Minimum purchase must be greater than 0"],
      "valid_days": ["Valid days must be between 1 and 365"]
    }
  },
  "timestamp": "2024-02-10T14:30:00Z"
}
```

```json 404 - Customer Not Found
{
  "success": false,
  "error": {
    "code": "CUSTOMER_NOT_FOUND",
    "message": "No customer found with the provided criteria",
    "details": {
      "searched_fields": ["member_code"],
      "values": ["ZP-12345678"]
    }
  },
  "timestamp": "2024-02-10T14:30:00Z"
}
```

```json 429 - Generation Limit Exceeded
{
  "success": false,
  "error": {
    "code": "GENERATION_LIMIT_EXCEEDED",
    "message": "Customer has reached the daily coupon generation limit",
    "details": {
      "daily_limit": 3,
      "current_count": 3,
      "reset_time": "2024-02-11T00:00:00Z"
    }
  },
  "timestamp": "2024-02-10T14:30:00Z"
}
```
</CodeGroup>

## Coupon Types

### Percentage Discount
- **Type**: `percentage`
- **Value**: 1-50% discount
- **Use Case**: General promotions, birthday rewards
- **Example**: 15% off with max R$100 discount

### Fixed Amount Discount  
- **Type**: `fixed_amount`
- **Value**: Fixed BRL amount off
- **Use Case**: Welcome bonuses, referral rewards
- **Example**: R$25 off any purchase over R$100

### Free Shipping
- **Type**: `free_shipping`
- **Value**: Not applicable
- **Use Case**: Cart abandonment recovery
- **Example**: Free delivery on any order

### Buy One Get One
- **Type**: `bogo`
- **Value**: Percentage off second item
- **Use Case**: Inventory clearance, category promotion
- **Example**: Buy 1, get 50% off the second item

### Points Multiplier
- **Type**: `points_multiplier`
- **Value**: Multiplier factor (2x, 3x, etc.)
- **Use Case**: Loyalty engagement campaigns
- **Example**: 2x points on all purchases for 7 days

## Personalization Features

### Dynamic Messaging
- Customer name integration
- Purchase history references
- Loyalty status recognition
- Milestone celebrations

### Visual Customization
- Brand color schemes (gold, silver, bronze)
- Customer segment-based designs
- Campaign-specific branding
- QR code styling

### Smart Targeting
- Customer segment-based discount values
- Purchase behavior-driven categories
- Seasonal and event-based triggers
- Geographic location considerations

## Business Rules

### Generation Limits
- **Daily Limit**: Maximum 3 coupons per customer per day
- **Campaign Limit**: Maximum 1 coupon per customer per campaign
- **Segment Limits**: VIP customers may have higher limits

### Validation Rules
- Minimum purchase amount must be greater than discount (for fixed amounts)
- Percentage discounts are capped at 50%
- Maximum discount amount prevents over-discounting
- Excluded products cannot be the only items in applicable categories

### Usage Restrictions
- Coupons cannot be combined with other promotional codes
- Some product categories may be globally excluded (gift cards, etc.)
- Store-specific coupons require location verification
- Online-only coupons require digital purchase channel

## Rate Limits

- **Production**: 100 requests per minute
- **Staging**: 25 requests per minute

## Error Codes

| Code | Description |
|------|-------------|
| `INVALID_COUPON_CONFIG` | Invalid discount parameters or restrictions |
| `CUSTOMER_NOT_FOUND` | No customer found with provided identifiers |
| `GENERATION_LIMIT_EXCEEDED` | Daily or campaign generation limits reached |
| `CAMPAIGN_INACTIVE` | Specified campaign is not currently active |
| `CATEGORY_RESTRICTION_ERROR` | Invalid category or exclusion configuration |
| `VALIDATION_ERROR` | Invalid data format in request body |
| `UNAUTHORIZED` | Missing or invalid API key |

<Note>
  **Smart Recommendations**: The API automatically suggests optimal discount values based on customer segment and purchase history to maximize redemption rates while protecting margins.
</Note>